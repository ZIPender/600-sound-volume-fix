<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="popup.css" rel="stylesheet">
    <title>600% Sound Volume</title>
    <link href="js/app.js" rel="preload" as="script">
    <link href="js/chunk-vendors.js" rel="preload" as="script">
</head>
<body>
<button class="theme-toggle" id="theme-toggle" title="Toggle theme">üåô</button>
<noscript><strong>We're sorry but popup doesn't work properly without JavaScript enabled. Please enable it to
    continue.</strong></noscript>
<div id="app"></div>
<script src="js/chunk-vendors.js"></script>
<script src="js/app.js"></script>
<script>
(function() {
    function _browser() {
        if (typeof browser !== 'undefined') {
            return browser;
        } else {
            return chrome;
        }
    }

    var themeToggle = document.getElementById('theme-toggle');
    
    function applyTheme(isDark) {
        if (isDark) {
            document.body.classList.add('dark-theme');
            themeToggle.textContent = '‚òÄÔ∏è';
            themeToggle.title = 'Switch to light theme';
        } else {
            document.body.classList.remove('dark-theme');
            themeToggle.textContent = 'üåô';
            themeToggle.title = 'Switch to dark theme';
        }
    }
    
    function detectBrowserTheme() {
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    }
    
    // Apply browser theme immediately while waiting for storage
    applyTheme(detectBrowserTheme());
    
    // Then load saved theme preference (overrides if user had set one)
    _browser().storage.local.get({themePreference: null}, function(result) {
        var isDark;
        if (result.themePreference !== null) {
            isDark = result.themePreference === 'dark';
            applyTheme(isDark);
        }
        // If no saved preference, keep the browser theme that was already applied
    });
    
    // Listen for browser theme changes
    if (window.matchMedia) {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            // Only apply browser theme if user hasn't set a manual preference
            _browser().storage.local.get({themePreference: null}, function(result) {
                if (result.themePreference === null) {
                    applyTheme(e.matches);
                }
            });
        });
    }
    
    // Toggle button click handler
    themeToggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        var isDark = document.body.classList.contains('dark-theme');
        var newTheme = isDark ? 'light' : 'dark';
        _browser().storage.local.set({themePreference: newTheme});
        applyTheme(!isDark);
    });
})();
</script>
</body>
</html>
